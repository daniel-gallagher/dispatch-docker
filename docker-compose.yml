version: "3.4"
x-restart-policy: &restart_policy
  restart: unless-stopped
x-dispatch-defaults: &dispatch_defaults
  <<: *restart_policy
  build:
    context: https://github.com/daniel-gallagher/dispatch.git#develop
  image: dispatch-local
  env_file:
    - .env
  depends_on:
    - postgres
services:
  postgres:
    <<: *restart_policy
    image: "postgres:9.6"
    volumes:
      - "dispatch-postgres:/var/lib/postgresql/data"
  web:
    <<: *dispatch_defaults
    command: ["server", "start", "dispatch.main:app"]
  dispatch-scheduler:
    <<: *dispatch_defaults
    command: ["scheduler", "start"]
volumes:
  dispatch-postgres:
    external: true
